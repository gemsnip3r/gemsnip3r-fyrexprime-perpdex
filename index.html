<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MonaPrime — Gorilla-Powered PerpDEX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* --- CSS (Aynı Tasarım Korundu, Dashboard Eklendi) --- */
    :root {
      --bg-dark: #000000;
      --bg-panel: #121212;
      --primary: #1DB954;
      --primary-hover: #1ed760;
      --primary-glow: rgba(29, 185, 84, 0.5);
      --text-main: #FFFFFF;
      --text-muted: #B3B3B3;
      --border: rgba(255, 255, 255, 0.15);
      --gold: #FFD700;
      --shadow-pop: 0 4px 8px rgba(0,0,0,0.8), 0 0 15px var(--primary-glow);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }
    body { background: var(--bg-dark); color: var(--text-main); font-family: 'Inter', sans-serif; overflow-x: hidden; }
    h1, h2, h3, h4, .btn { font-family: 'Space Grotesk', sans-serif; text-shadow: var(--shadow-pop); }

    /* Fixes */
    .hero { min-height: 100vh; padding: 120px 20px 80px; display: flex; align-items: center; justify-content: center; }
    .hero-container { max-width: 1200px; width: 100%; display: grid; grid-template-columns: 1fr 0.8fr; gap: 60px; align-items: center; }
    .hero-title { font-size: clamp(40px, 5vw, 72px); font-weight: 800; line-height: 1; margin-bottom: 20px; }
    .hero-title span { color: var(--primary); }
    .hero-desc { color: var(--text-muted); font-size: 18px; margin-bottom: 30px; max-width: 500px; }
    
    /* DASHBOARD & QUESTS */
    .waitlist-container { width: 100%; max-width: 500px; }
    .waitlist-form { background: #1a1a1a; padding: 10px; border-radius: 12px; display: flex; border: 1px solid var(--border); }
    .wl-input { flex: 1; background: transparent; border: none; padding: 0 15px; color: #fff; outline: none; }
    .btn-main { padding: 12px 28px; background: var(--primary); border: none; color: #000; font-weight: 800; border-radius: 8px; cursor: pointer; }
    
    .dashboard-panel { display: none; background: #111; border: 1px solid var(--primary); padding: 25px; border-radius: 16px; animation: slideUp 0.5s ease; box-shadow: 0 0 40px var(--primary-glow); }
    .dash-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
    .user-xp { font-size: 24px; font-weight: 800; color: var(--primary); }
    .user-rank { font-size: 14px; color: #888; }
    
    .ref-box { background: #222; padding: 12px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border: 1px dashed #555; }
    .ref-link { color: #fff; font-family: monospace; font-size: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-right: 10px; }
    .copy-btn { background: var(--primary); color: #000; font-weight: 700; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; }

    .quest-list { display: flex; flex-direction: column; gap: 10px; }
    .quest-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); padding: 12px 15px; border-radius: 8px; transition: 0.2s; }
    .quest-item:hover { background: rgba(255,255,255,0.1); }
    .q-info { display: flex; align-items: center; gap: 10px; color: #fff; font-size: 14px; font-weight: 600; }
    .q-badge { background: #333; color: var(--gold); font-size: 11px; padding: 2px 6px; border-radius: 4px; }
    .q-btn { background: transparent; border: 1px solid var(--border); color: #fff; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; transition: 0.2s; }
    .q-btn:hover { border-color: var(--primary); color: var(--primary); }
    .q-btn.claimed { background: var(--success); color: #000; border: none; cursor: default; }

    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    /* Other Styles (Simplified for context) */
    .navbar { position: fixed; width: 100%; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; z-index: 100; background: rgba(0,0,0,0.95); border-bottom: 1px solid var(--border); }
    .brand { display: flex; gap: 10px; align-items: center; text-decoration: none; color: #fff; font-weight: 800; font-size: 22px; }
    .brand img { width: 40px; border-radius: 50%; border: 2px solid var(--primary); }
    .nav-links { display: flex; gap: 20px; } .nav-link { color: #aaa; text-decoration: none; font-weight: 600; cursor:pointer; }
    .btn-connect { padding: 10px 20px; border: 1px solid #fff; background: transparent; color: #fff; border-radius: 50px; cursor: pointer; }
    
    .stats-row { display: flex; justify-content: center; gap: 30px; margin-bottom: 80px; flex-wrap: wrap; }
    .stat-card { background: #121212; border: 1px solid var(--border); padding: 25px 40px; border-radius: 16px; text-align: center; min-width: 200px; }
    .stat-val { font-size: 32px; font-weight: 800; color: var(--primary); display: block; }
    
    .lb-section { padding: 80px 20px; max-width: 800px; margin: 0 auto; }
    .lb-table { width: 100%; border-collapse: collapse; background: #121212; border-radius: 12px; }
    .lb-table th { text-align: left; padding: 20px; color: #888; font-size: 12px; text-transform: uppercase; }
    .lb-table td { padding: 15px 20px; border-bottom: 1px solid #222; font-weight: 600; }
    .rank-1 { color: var(--gold); }

    /* Responsive */
    @media(max-width:900px){ .hero-container{grid-template-columns:1fr; text-align:center;} .nav-links{display:none;} .visual-box{display:none;} }
    
    /* Background */
    #chart-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.15; pointer-events: none; }
    .ambient-glow { position: fixed; top: -30%; right: -10%; width: 60vw; height: 60vw; background: radial-gradient(circle, var(--primary-glow), transparent 70%); filter: blur(120px); z-index: -2; }
  </style>
</head>
<body>

  <div class="ambient-glow"></div>
  <canvas id="chart-canvas"></canvas>

  <nav class="navbar">
    <a href="#" class="brand">
      <img src="logo.png" alt="MonaPrime">
      <h1>MonaPrime</h1>
    </a>
    <div class="nav-links">
      <div class="nav-link" onclick="document.getElementById('genesis').scrollIntoView()">Utility</div>
      <div class="nav-link" onclick="document.getElementById('leaderboard').scrollIntoView()">Leaderboard</div>
      <div class="nav-link" onclick="document.getElementById('roadmap').scrollIntoView()">Roadmap</div>
    </div>
    <button class="btn-connect">Connect Wallet</button>
  </nav>

  <header class="hero">
    <div class="hero-container">
      <div class="hero-text">
        <div style="background:var(--primary); color:#000; display:inline-block; padding:4px 12px; border-radius:4px; font-weight:800; font-size:12px; margin-bottom:20px;">GORILLA SEASON BEGINS</div>
        <h1 class="hero-title">The Genesis Utility <br> <span>on Monad.</span></h1>
        <p class="hero-desc">Fastest, strongest, gorilla-powered PerpDEX. <br>Join the troop, complete quests, and climb the ranks.</p>
        
        <div class="waitlist-container">
          <form id="joinForm" class="waitlist-form">
            <input type="email" id="email" class="wl-input" placeholder="Enter your email..." required>
            <button type="submit" class="btn-main">Start Quests</button>
          </form>

          <div id="dashboard" class="dashboard-panel">
            <div class="dash-header">
              <div>
                <div class="user-xp" id="displayXP">100 XP</div>
                <div class="user-rank">Rank: Calculating...</div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:12px; color:#888;">STATUS</div>
                <div style="color:var(--success); font-weight:700;">ACTIVE</div>
              </div>
            </div>

            <div style="font-size:12px; color:#aaa; margin-bottom:8px;">YOUR REFERRAL LINK (+150 XP each)</div>
            <div class="ref-box">
              <span id="refLink" class="ref-link">...</span>
              <button class="copy-btn" onclick="copyRef()">COPY</button>
            </div>

            <div style="font-size:12px; color:#aaa; margin-bottom:8px;">QUESTS</div>
            <div class="quest-list">
              <div class="quest-item">
                <div class="q-info">
                  <span>Follow on X</span> <span class="q-badge">+200 XP</span>
                </div>
                <button class="q-btn" id="btn-twitter" onclick="doTask('twitter', 'https://x.com/monadprimates')">Go</button>
              </div>
              <div class="quest-item">
                <div class="q-info">
                  <span>Join Telegram</span> <span class="q-badge">+200 XP</span>
                </div>
                <button class="q-btn" id="btn-telegram" onclick="doTask('telegram', 'https://t.me/MonaPrime')">Go</button>
              </div>
              <div class="quest-item">
                <div class="q-info">
                  <span>Invite 3 Friends</span> <span class="q-badge">+450 XP</span>
                </div>
                <button class="q-btn" style="cursor:default; border-color:#333; color:#666;">Auto-Track</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="visual-box">
        <div class="nft-card">
          <img src="logo.png" style="width:180px; filter:drop-shadow(0 0 20px var(--primary));">
          <h2 style="font-family:'Space Grotesk'; margin-top:20px; color:#fff;">Utility Key</h2>
          <p style="color:var(--primary); font-weight:700;">GENESIS</p>
        </div>
      </div>
    </div>
  </header>

  <section class="stats-row">
    <div class="stat-card"><span class="stat-val">2,222</span><span class="stat-label">Fixed Supply</span></div>
    <div class="stat-card"><span class="stat-val">MONAD</span><span class="stat-label">Chain</span></div>
    <div class="stat-card"><span class="stat-val">90%</span><span class="stat-label">Fee Discount</span></div>
  </section>

  <section id="leaderboard" class="lb-section">
    <div class="lb-header">
      <h2 class="section-title" style="font-size:36px; font-weight:700; text-align:center;">Top Recruiters</h2>
      <p style="color:var(--text-muted); text-align:center;">Real-time. Top 500 get guaranteed WL.</p>
    </div>
    <table class="lb-table">
      <thead><tr><th>Rank</th><th>User</th><th style="text-align:right;">XP</th></tr></thead>
      <tbody id="lbBody">
        <tr><td colspan="3" style="text-align:center; padding:20px; color:#555;">Connecting to Monad...</td></tr>
      </tbody>
    </table>
  </section>

  <section id="roadmap" style="text-align:center; padding:100px 20px;">
    <h2>Roadmap & Utility</h2>
    <p style="color:#888;">See whitepaper for full details.</p>
  </section>

  <footer>
    <p>© 2025 MonaPrime. Built on Monad.</p>
  </footer>

  <script>
    /* --- CHART --- */
    const canvas=document.getElementById('chart-canvas'); const ctx=canvas.getContext('2d'); let w,h,prices=[],last=window.innerHeight/2;
    function init(){ w=window.innerWidth; h=window.innerHeight; canvas.width=w; canvas.height=h; prices=[]; for(let i=0;i<Math.ceil(w/10);i++)upd(); }
    function upd(){ let c=(Math.random()-0.5)*15; last+=c; if(last<100)last+=10; if(last>h-100)last-=10; prices.push(last); if(prices.length>Math.ceil(w/10)+5)prices.shift(); }
    function draw(){ ctx.clearRect(0,0,w,h); for(let i=1;i<prices.length;i++){ let o=prices[i-1],c=prices[i],x=i*10,g=c<o; ctx.fillStyle=g?'#1DB954':'#E91429'; ctx.fillRect(x,Math.min(o,c),6,Math.abs(o-c)||1); } upd(); requestAnimationFrame(draw); }
    window.addEventListener('resize',init); init(); draw();

    /* --- REAL BACKEND LOGIC --- */
    let currentUserEmail = null;

    // 1. Load Leaderboard
    async function loadLeaderboard() {
      try {
        const res = await fetch('/api/leaderboard');
        const data = await res.json();
        const tbody = document.getElementById('lbBody');
        tbody.innerHTML = '';
        if(data.length === 0) { tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;">No data yet. Be the first!</td></tr>'; return; }
        
        data.forEach((u, i) => {
          let color = i===0 ? 'color:#FFD700' : '#fff';
          tbody.innerHTML += `<tr><td style="${color};font-weight:800;">#${i+1}</td><td>${u.name}</td><td style="text-align:right;color:#1DB954;">${u.xp} XP</td></tr>`;
        });
      } catch (e) { console.log("Leaderboard waiting for API deployment..."); }
    }
    loadLeaderboard();

    // 2. Join System
    const form = document.getElementById('joinForm');
    form.addEventListener('submit', async(e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const btn = form.querySelector('button');
      btn.innerText = "Connecting...";
      
      const urlParams = new URLSearchParams(window.location.search);
      const referrerCode = urlParams.get('ref');

      try {
        const res = await fetch('/api/join', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ email, referrerCode })
        });
        const data = await res.json();

        if (res.ok) {
          currentUserEmail = email; // Store for tasks
          form.style.display='none';
          document.getElementById('dashboard').style.display='block';
          
          document.getElementById('refLink').innerText = `${window.location.origin}/?ref=${data.myCode}`;
          document.getElementById('displayXP').innerText = `${data.xp} XP`;
          
          // Check previous tasks status if user exists
          if(data.tasks && data.tasks.twitter) markTaskDone('btn-twitter');
          if(data.tasks && data.tasks.telegram) markTaskDone('btn-telegram');

          loadLeaderboard(); // Refresh
        } else {
          alert("Error: " + data.error);
        }
      } catch (err) {
        alert("API Error: Please verify api/join.js is deployed.");
      } finally {
        btn.innerText = "Join & Earn XP";
      }
    });

    // 3. Quest Logic
    async function doTask(taskID, url) {
      const btn = document.getElementById(`btn-${taskID}`);
      if(btn.classList.contains('claimed')) return;

      // Open Link
      window.open(url, '_blank');
      
      // Change button state to 'Claiming...'
      btn.innerText = "Verifying...";
      
      // Wait 5 seconds (Simulating verify)
      setTimeout(async () => {
        try {
          const res = await fetch('/api/task', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ email: currentUserEmail, taskID })
          });
          const data = await res.json();
          
          if(data.success) {
            document.getElementById('displayXP').innerText = `${data.newXP} XP`;
            markTaskDone(`btn-${taskID}`);
            loadLeaderboard();
          }
        } catch(e) { console.error(e); }
      }, 4000);
    }

    function markTaskDone(btnID) {
      const btn = document.getElementById(btnID);
      btn.innerText = "CLAIMED";
      btn.classList.add('claimed');
    }

    function copyRef() { navigator.clipboard.writeText(document.getElementById('refLink').innerText); alert("Copied!"); }
  </script>
</body>
</html>